name: ipython_miniconda

on: [pull_request]

jobs:
  test:
    runs-on: windows-latest

    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.7", "3.8", "3.9"]
        file: [demo1.py demo2.py]

    steps:
      - name: Checkout source
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Setup Conda Environment
        # TODO replace with label as soon as it's available
        # https://github.com/conda-incubator/setup-miniconda/issues/106
        uses: conda-incubator/setup-miniconda@77b16ed746da28724c61e1f1ad23395a4b695ef5
        with:
          miniconda-version: latest
          python-version: ${{ matrix.python-version }}
          environment-file: continuous_integration/demo_ipython.yaml
          activate-environment: demo
          auto-activate-base: false

      - name: conda list
        shell: bash -l {0}
        run: conda list

      - name: Test
        shell: bash -l {0}
        run: python ${{ matrix.file }}
